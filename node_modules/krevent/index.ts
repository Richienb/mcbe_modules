
import '@mcbe/dummy-console';
export default class Event<T extends (...args:any[])=>(boolean|void)>
{
    private readonly listeners:T[] = [];

    isEmpty():boolean
    {
        return this.listeners.length === 0;
    }

    on(listener:T):void
    {
        this.listeners.push(listener);
    }

    onBefore(listener:T, needle:T):void
    {
        const idx = this.listeners.indexOf(needle);
        if (idx === -1) throw Error('needle not found');
        this.listeners.splice(idx, 0, listener);
    }

    onAfter(listener:T, needle:T):void
    {
        const idx = this.listeners.indexOf(needle);
        if (idx === -1) throw Error('needle not found');
        this.listeners.splice(idx+1, 0, listener);
    }

    remove(listener:T):boolean
    {
        const idx = this.listeners.indexOf(listener);
        if (idx !== -1)
        {
            this.listeners.splice(idx, 1);
            return true;
        }
        return false;
    }

    fire(...v:T extends (...args:infer ARGS)=>any ? ARGS : never):boolean
    {
        for (const listener of this.listeners)
        {
            try
            {
                if (listener(...v)) return true;
            }
            catch (err)
            {
                console.error(err);
            }
        }
        return false;
    }
}
